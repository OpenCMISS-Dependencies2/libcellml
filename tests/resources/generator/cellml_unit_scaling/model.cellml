<?xml version='1.0' encoding='UTF-8'?>
<model name="my_model" xmlns="http://www.cellml.org/cellml/2.0#" xmlns:cellml="http://www.cellml.org/cellml/2.0#">
    <!-- Different tests to check that unit conversation is properly handled at
the connection level:
 - A component, constants, where we define a constant, k.
 - A component, states, where we initialise and compute a state variable, y, and
   initialise two state variables, t_z and scaled_t_z.
 - Two main components:
    - One where the VOI, t, is expressed in milliseconds; and
    - Another where the VOI, scaled_t, is expressed in seconds.
 - Each of these two main components features the following:
    - Compute the [scaled_]voi variable.
    - Compute the x state variable, which is initialised in this component;
    - Compute the scaled_x state variable. which is initialised in this
      component;
    - Compute the [scaled_]z state variable, which is initialised in the states
      component.
    - Compute the scaled_dTdt variable. -->
    <units name="ms">
        <unit prefix="milli" units="second"/>
    </units>
    <units name="mV">
        <unit prefix="milli" units="volt"/>
    </units>
    <units name="V_per_mS">
        <unit units="volt"/>
        <unit exponent="-1" units="ms"/>
    </units>
    <units name="V_per_s">
        <unit units="volt"/>
        <unit exponent="-1" units="second"/>
    </units>
    <component name="environment">
        <variable interface="public" name="t" units="ms"/>
    </component>
    <component name="constants">
        <variable initial_value="123" interface="public" name="k" units="mV"/>
    </component>
    <component name="states">
        <variable interface="public" name="t" units="ms"/>
        <variable initial_value="789" interface="public" name="y" units="mV"/>
        <variable initial_value="1.23" interface="public" name="t_z" units="mV"/>
        <variable initial_value="7.89" interface="public" name="scaled_t_z" units="mV"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>y</ci>
                </apply>
                <cn cellml:units="mV">1.23</cn>
            </apply>
        </math>
    </component>
    <component name="t">
        <variable interface="public" name="t" units="ms"/>
        <variable interface="public" name="voi" units="ms"/>
        <variable initial_value="1" interface="public" name="x" units="mV"/>
        <variable interface="public" name="k" units="mV"/>
        <variable interface="public" name="y" units="mV"/>
        <variable initial_value="3" interface="public" name="scaled_x" units="volt"/>
        <variable interface="public" name="scaled_k" units="volt"/>
        <variable interface="public" name="scaled_y" units="volt"/>
        <variable interface="public" name="z" units="mV"/>
        <variable name="scaled_dTdt" units="V_per_ms"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>voi</ci>
                <ci>t</ci>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>x</ci>
                </apply>
                <apply>
                    <plus/>
                    <ci>k</ci>
                    <ci>y</ci>
                    <ci>z</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>scaled_x</ci>
                </apply>
                <apply>
                    <plus/>
                    <ci>scaled_k</ci>
                    <ci>scaled_y</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>t</ci>
                    </bvar>
                    <ci>z</ci>
                </apply>
                <apply>
                    <plus/>
                    <ci>k</ci>
                    <ci>y</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>scaled_dTdt</ci>
                <apply>
                    <plus/>
                    <apply>
                        <diff/>
                        <bvar>
                            <ci>t</ci>
                        </bvar>
                        <ci>scaled_x</ci>
                    </apply>
                    <apply>
                        <diff/>
                        <bvar>
                            <ci>t</ci>
                        </bvar>
                        <ci>scaled_y</ci>
                    </apply>
                </apply>
            </apply>
        </math>
    </component>
    <component name="scaled_t">
        <variable interface="public" name="scaled_t" units="second"/>
        <variable interface="public" name="scaled_voi" units="second"/>
        <variable initial_value="101" interface="public" name="x" units="mV"/>
        <variable interface="public" name="k" units="mV"/>
        <variable interface="public" name="y" units="mV"/>
        <variable initial_value="103" interface="public" name="scaled_x" units="volt"/>
        <variable interface="public" name="scaled_k" units="volt"/>
        <variable interface="public" name="scaled_y" units="volt"/>
        <variable interface="public" name="scaled_z" units="volt"/>
        <variable name="scaled_dTdt" units="V_per_s"/>
        <math xmlns="http://www.w3.org/1998/Math/MathML">
            <apply>
                <eq/>
                <ci>scaled_voi</ci>
                <ci>scaled_t</ci>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>scaled_t</ci>
                    </bvar>
                    <ci>x</ci>
                </apply>
                <apply>
                    <plus/>
                    <ci>k</ci>
                    <ci>y</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>scaled_t</ci>
                    </bvar>
                    <ci>scaled_x</ci>
                </apply>
                <apply>
                    <plus/>
                    <ci>scaled_k</ci>
                    <ci>scaled_y</ci>
                    <ci>scaled_z</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <apply>
                    <diff/>
                    <bvar>
                        <ci>scaled_t</ci>
                    </bvar>
                    <ci>scaled_z</ci>
                </apply>
                <apply>
                    <plus/>
                    <ci>scaled_k</ci>
                    <ci>scaled_y</ci>
                </apply>
            </apply>
            <apply>
                <eq/>
                <ci>scaled_dTdt</ci>
                <apply>
                    <plus/>
                    <apply>
                        <diff/>
                        <bvar>
                            <ci>scaled_t</ci>
                        </bvar>
                        <ci>scaled_x</ci>
                    </apply>
                    <apply>
                        <diff/>
                        <bvar>
                            <ci>scaled_t</ci>
                        </bvar>
                        <ci>scaled_y</ci>
                    </apply>
                </apply>
            </apply>
        </math>
    </component>
    <connection component_1="environment" component_2="states">
        <map_variables variable_1="t" variable_2="t"/>
    </connection>
    <connection component_1="environment" component_2="t">
        <map_variables variable_1="t" variable_2="t"/>
    </connection>
    <connection component_1="t" component_2="constants">
        <map_variables variable_1="k" variable_2="k"/>
        <map_variables variable_1="scaled_k" variable_2="k"/>
    </connection>
    <connection component_1="t" component_2="states">
        <map_variables variable_1="y" variable_2="y"/>
        <map_variables variable_1="scaled_y" variable_2="y"/>
        <map_variables variable_1="z" variable_2="t_z"/>
    </connection>
    <connection component_1="environment" component_2="scaled_t">
        <map_variables variable_1="t" variable_2="scaled_t"/>
    </connection>
    <connection component_1="scaled_t" component_2="constants">
        <map_variables variable_1="k" variable_2="k"/>
        <map_variables variable_1="scaled_k" variable_2="k"/>
    </connection>
    <connection component_1="scaled_t" component_2="states">
        <map_variables variable_1="y" variable_2="y"/>
        <map_variables variable_1="scaled_y" variable_2="y"/>
        <map_variables variable_1="scaled_z" variable_2="scaled_t_z"/>
    </connection>
</model>
